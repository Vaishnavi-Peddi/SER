<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Emotion Detection</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    .emoji { font-size: 2rem; }
  </style>
</head>
<body>
<div class="container py-4">
  <h1 class="mb-4">Emotion Detection</h1>

  <form method="POST" enctype="multipart/form-data">
    <h4>ðŸŽ§ Analyze Uploaded Audio </h4>
    <input class="form-control mb-2" type="file" name="file" accept="audio/*" required />
    <button name="analyze_audio" class="btn btn-primary mb-4" type="submit">Analyze Audio</button>
  </form>

  <form method="POST" id="record-form">
    <h4>ðŸŽ¤ Analyze Recorded Audio </h4>
    <div class="mb-2">
      <select class="form-select" name="language">
        <option value="te_IN">Telugu</option>
        <option value="en_IN">English</option>
        <option value="hi_IN">Hindi</option>
        <option value="ta_IN">Tamil</option>
      </select>
    </div>
    <button type="button" class="btn btn-outline-primary" id="record-btn">Start Recording</button>
    <button type="button" class="btn btn-outline-danger" id="stop-btn" disabled>Stop</button>
    <audio id="recorded-audio" controls class="my-2"></audio>
    <input type="hidden" name="audio_data" id="audio-data" />
    <button name="analyze_text" class="btn btn-success mt-2" type="submit">Analyze Recording</button>
  </form>

  {% if transcribed_text %}
    <div class="alert alert-info mt-4">
      <strong>Transcribed:</strong> {{ transcribed_text }}
    </div>
  {% endif %}

  {% if translated_text %}
    <div class="alert alert-secondary">
      <strong>Translated:</strong> {{ translated_text }}
    </div>
  {% endif %}

  {% if text_emotion %}
    <div class="alert alert-success">
      <strong>Text Emotion:</strong> {{ text_emotion|capitalize }} <span class="emoji">{{ text_emoji }}</span>
    </div>
  {% endif %}

  {% if audio_emotion %}
    <div class="alert alert-warning">
      <strong>Audio Emotion:</strong> {{ audio_emotion|capitalize }} <span class="emoji">{{ audio_emoji }}</span>
    </div>
  {% endif %}
</div>

<script>
  let recordBtn = document.getElementById('record-btn');
  let stopBtn = document.getElementById('stop-btn');
  let audioInput = document.getElementById('audio-data');
  let audioPlayer = document.getElementById('recorded-audio');
  let recorder, audioChunks = [];

  recordBtn.onclick = async () => {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    recorder = new MediaRecorder(stream);
    audioChunks = [];
    recorder.ondataavailable = e => audioChunks.push(e.data);
    recorder.onstop = () => {
      const blob = new Blob(audioChunks, { type: 'audio/webm' });
      audioPlayer.src = URL.createObjectURL(blob);
      const reader = new FileReader();
      reader.onloadend = () => audioInput.value = reader.result;
      reader.readAsDataURL(blob);
    };
    recorder.start();
    recordBtn.disabled = true;
    stopBtn.disabled = false;
  };

  stopBtn.onclick = () => {
    recorder.stop();
    recordBtn.disabled = false;
    stopBtn.disabled = true;
  };
</script>
</body>
</html>